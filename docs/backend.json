{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Represents a user account within the BitHired application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "mobileNumber": {
          "type": "string",
          "description": "User's mobile phone number, used for login."
        },
        "virtualBalance": {
          "type": "number",
          "description": "The user's current virtual currency balance."
        }
      },
      "required": [
        "id",
        "mobileNumber"
      ]
    },
    "MiningMachine": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MiningMachine",
      "type": "object",
      "description": "Represents a virtual mining machine available for hire.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the mining machine."
        },
        "name": {
          "type": "string",
          "description": "Name of the mining machine."
        },
        "miningRate": {
          "type": "number",
          "description": "The mining rate of the machine."
        }
      },
      "required": [
        "id",
        "name",
        "miningRate"
      ]
    },
    "RentalTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RentalTransaction",
      "type": "object",
      "description": "Represents a transaction where a user hires a mining machine.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the rental transaction."
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:N RentalTransaction)"
        },
        "miningMachineId": {
          "type": "string",
          "description": "Reference to MiningMachine. (Relationship: MiningMachine 1:N RentalTransaction)"
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the rental period.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the rental period.",
          "format": "date-time"
        },
        "rentalCost": {
          "type": "number",
          "description": "The cost of renting the mining machine for the specified period."
        }
      },
      "required": [
        "id",
        "userAccountId",
        "miningMachineId",
        "startDate",
        "endDate",
        "rentalCost"
      ]
    },
    "DepositTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DepositTransaction",
      "type": "object",
      "description": "Represents a deposit transaction initiated by a user, awaiting admin confirmation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the deposit transaction."
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:N DepositTransaction)"
        },
        "amount": {
          "type": "number",
          "description": "The amount the user intends to deposit."
        },
        "transactionCode": {
          "type": "string",
          "description": "The unique code for the user to include in their M-PESA transaction."
        },
        "status": {
          "type": "string",
          "enum": ["pending", "completed", "cancelled"],
          "description": "The current status of the deposit."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the deposit was initiated."
        },
        "mobileNumber": {
            "type": "string",
            "description": "The user's mobile number, denormalized for admin convenience."
        }
      },
      "required": [
        "id",
        "userAccountId",
        "amount",
        "transactionCode",
        "status",
        "createdAt",
        "mobileNumber"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information. Uses path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user account, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/mining_machines/{miningMachineId}",
        "definition": {
          "entityName": "MiningMachine",
          "schema": {
            "$ref": "#/backend/entities/MiningMachine"
          },
          "description": "Stores information about available mining machines.",
          "params": [
            {
              "name": "miningMachineId",
              "description": "The unique identifier for the mining machine."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/rentals/{rentalId}",
        "definition": {
          "entityName": "RentalTransaction",
          "schema": {
            "$ref": "#/backend/entities/RentalTransaction"
          },
          "description": "Stores rental transaction data for a user. Includes denormalized 'userAccountId' to guarantee authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user account that created this rental transaction. (Relationship: UserAccount 1:N RentalTransaction)"
            },
            {
              "name": "rentalId",
              "description": "The unique identifier for the rental transaction."
            }
          ]
        }
      },
      {
        "path": "/deposit_transactions/{depositTransactionId}",
        "definition": {
          "entityName": "DepositTransaction",
          "schema": {
            "$ref": "#/backend/entities/DepositTransaction"
          },
          "description": "Stores all deposit transactions. Admin needs to read all of them to confirm. User can read their own.",
          "params": [
            {
              "name": "depositTransactionId",
              "description": "The unique identifier for the deposit transaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging. User-specific data like rentals are nested under the user's document for clear ownership and security. Global data like mining machines are in a root collection. Deposit transactions are in a root collection so that admins can query all of them, with security rules ensuring users can only read their own, while admins can read all and update status."
  }
}
