{"entities":{"User":{"$schema":"http://json-schema.org/draft-07/schema#","title":"User","type":"object","description":"Represents a user of the BitHired application.","properties":{"id":{"type":"string","description":"Unique identifier for the user."},"mobileNumber":{"type":"string","description":"The user's mobile phone number."},"virtualBalance":{"type":"number","description":"The user's current balance of virtual money."}},"required":["id","mobileNumber","virtualBalance"]},"MiningMachine":{"$schema":"http://json-schema.org/draft-07/schema#","title":"MiningMachine","type":"object","description":"Represents a virtual mining machine available for hiring.","properties":{"id":{"type":"string","description":"Unique identifier for the mining machine."},"name":{"type":"string","description":"The name of the mining machine."},"miningRate":{"type":"number","description":"The mining rate of the machine (e.g., BTC/hour)."},"costPerDay":{"type":"number","description":"The cost to hire the machine for one day in virtual currency."}},"required":["id","name","miningRate","costPerDay"]},"HiringTransaction":{"$schema":"http://json-schema.org/draft-07/schema#","title":"HiringTransaction","type":"object","description":"Represents a single hiring transaction for a mining machine.","properties":{"id":{"type":"string","description":"Unique identifier for the hiring transaction."},"userId":{"type":"string","description":"Reference to User. (Relationship: User 1:N HiringTransaction)"},"machineId":{"type":"string","description":"Reference to MiningMachine. (Relationship: MiningMachine 1:N HiringTransaction)"},"startDate":{"type":"string","description":"The start date and time of the hiring period.","format":"date-time"},"endDate":{"type":"string","description":"The end date and time of the hiring period.","format":"date-time"},"durationDays":{"type":"number","description":"The duration of the hiring period in days."},"cost":{"type":"number","description":"The cost of the hiring transaction in virtual currency."}},"required":["id","userId","machineId","startDate","endDate","durationDays","cost"]},"MpesaTransaction":{"$schema":"http://json-schema.org/draft-07/schema#","title":"MpesaTransaction","type":"object","description":"Represents a transaction for recharging the user's virtual money balance via Mpesa.","properties":{"id":{"type":"string","description":"Unique identifier for the Mpesa transaction."},"userId":{"type":"string","description":"Reference to User. (Relationship: User 1:N MpesaTransaction)"},"mpesaCode":{"type":"string","description":"The Mpesa transaction code."},"amount":{"type":"number","description":"The amount of money transferred via Mpesa."},"transactionDate":{"type":"string","description":"The date and time of the Mpesa transaction.","format":"date-time"},"virtualMoneyCredited":{"type":"number","description":"The amount of virtual money credited to the user's account as a result of this transaction."}},"required":["id","userId","mpesaCode","amount","transactionDate","virtualMoneyCredited"]}},"auth":{"providers":["password","anonymous"]},"firestore":{"structure":[{"path":"/users/{userId}","definition":{"entityName":"User","schema":{"$ref":"#/backend/entities/User"},"description":"Stores user profiles. Secured via path-based ownership.","params":[{"name":"userId","description":"The unique identifier of the user."}]}},{"path":"/mining_machines/{machineId}","definition":{"entityName":"MiningMachine","schema":{"$ref":"#/backend/entities/MiningMachine"},"description":"Stores information about available mining machines. Publicly readable.","params":[{"name":"machineId","description":"The unique identifier of the mining machine."}]}},{"path":"/users/{userId}/hiring_transactions/{transactionId}","definition":{"entityName":"HiringTransaction","schema":{"$ref":"#/backend/entities/HiringTransaction"},"description":"Stores hiring transactions for a specific user. Secured via path-based ownership.","params":[{"name":"userId","description":"The unique identifier of the user."},{"name":"transactionId","description":"The unique identifier of the hiring transaction."}]}},{"path":"/users/{userId}/mpesa_transactions/{transactionId}","definition":{"entityName":"MpesaTransaction","schema":{"$ref":"#/backend/entities/MpesaTransaction"},"description":"Stores Mpesa transactions for a specific user. Secured via path-based ownership.","params":[{"name":"userId","description":"The unique identifier of the user."},{"name":"transactionId","description":"The unique identifier of the Mpesa transaction."}]}}],"reasoning":"The Firestore data structure is designed to support the BitHired application, focusing on user management, mining machine hiring, and transaction tracking. It prioritizes security, scalability, and ease of debugging by adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and Rules are not Filters (QAPs). \n\nAuthorization Independence is achieved through path-based ownership for user-specific data, such as hiring transactions and Mpesa transactions. This eliminates the need for `get()` calls in security rules to check parent document attributes. Collaborative data is not applicable in this schema, so Membership Maps are not needed. However, if the application evolves to include shared mining machines, membership maps should be adopted.\n\nStructural Segregation is enforced by keeping different data types in separate collections (e.g., users, mining machines). This ensures that all documents within a collection share the same security requirements, simplifying the rules.\n\nAccess Modeling utilizes path-based ownership for user-owned data. For example, hiring transactions are stored under `/users/{userId}/hiring_transactions/{transactionId}`, making it easy to secure access based on the authenticated user's ID. Mining machines are stored globally and can be read by all users.\n\nData Clarity and Predictability are maintained by using explicit field names and a consistent structure across all documents. This makes the data easier to understand and query.\n\nThis structure supports the required QAPs by enabling secure `list` operations. Because access control is based on path-based ownership, listing transactions for a specific user is secure and efficient. The separation of global mining machines from user-specific data also supports secure listing operations."}}