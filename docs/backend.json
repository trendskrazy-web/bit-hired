
{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Represents a user account within the BitHired application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address, used for login."
        },
        "mobileNumber": {
          "type": "string",
          "description": "User's mobile phone number."
        },
        "virtualBalance": {
          "type": "number",
          "description": "The user's current virtual currency balance."
        },
        "referralCode": {
            "type": "string",
            "description": "A unique code assigned to the user for inviting others."
        },
        "invitedBy": {
            "type": "string",
            "description": "The UID of the user who referred this user."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "mobileNumber"
      ]
    },
    "UserMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserMessage",
      "type": "object",
      "description": "Represents a message sent from an admin to a user's inbox.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the message."
        },
        "title": {
          "type": "string",
          "description": "The title or subject of the message."
        },
        "content": {
          "type": "string",
          "description": "The main body of the message, which can include redeem codes or other information."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the message was sent."
        },
        "read": {
          "type": "boolean",
          "description": "Whether the user has read the message."
        },
        "userId": {
          "type": "string",
          "description": "The UID of the user who received the message."
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "createdAt",
        "read",
        "userId"
      ]
    },
    "MiningMachine": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MiningMachine",
      "type": "object",
      "description": "Represents a virtual mining machine available for hire.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the mining machine."
        },
        "name": {
          "type": "string",
          "description": "Name of the mining machine."
        },
        "miningRate": {
          "type": "number",
          "description": "The mining rate of the machine."
        }
      },
      "required": [
        "id",
        "name",
        "miningRate"
      ]
    },
    "RentalTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RentalTransaction",
      "type": "object",
      "description": "Represents a transaction where a user hires a mining machine.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the rental transaction."
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:N RentalTransaction)"
        },
        "miningMachineId": {
          "type": "string",
          "description": "Reference to MiningMachine. (Relationship: MiningMachine 1:N RentalTransaction)"
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the rental period.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the rental period.",
          "format": "date-time"
        },
        "rentalCost": {
          "type": "number",
          "description": "The cost of renting the mining machine for the specified period."
        }
      },
      "required": [
        "id",
        "userAccountId",
        "miningMachineId",
        "startDate",
        "endDate",
        "rentalCost"
      ]
    },
    "DepositTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DepositTransaction",
      "type": "object",
      "description": "Represents a deposit transaction initiated by a user, awaiting admin confirmation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the deposit transaction."
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:N DepositTransaction)"
        },
        "amount": {
          "type": "number",
          "description": "The amount the user intends to deposit."
        },
        "status": {
          "type": "string",
          "enum": [
            "pending",
            "completed",
            "cancelled"
          ],
          "description": "The current status of the deposit."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the deposit was initiated."
        },
        "mobileNumber": {
          "type": "string",
          "description": "The user's mobile number, denormalized for admin convenience."
        }
      },
      "required": [
        "id",
        "userAccountId",
        "amount",
        "status",
        "createdAt",
        "mobileNumber"
      ]
    },
    "WithdrawalTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WithdrawalTransaction",
      "type": "object",
      "description": "Represents a withdrawal transaction initiated by a user, awaiting admin confirmation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the withdrawal transaction."
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount."
        },
        "amount": {
          "type": "number",
          "description": "The amount the user intends to withdraw."
        },
        "status": {
          "type": "string",
          "enum": [
            "pending",
            "completed",
            "cancelled"
          ],
          "description": "The current status of the withdrawal."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the withdrawal was initiated."
        },
        "mobileNumber": {
          "type": "string",
          "description": "The user's mobile number for the M-PESA transfer."
        }
      },
      "required": [
        "id",
        "userAccountId",
        "amount",
        "status",
        "createdAt",
        "mobileNumber"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification for an admin action.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the notification."
        },
        "message": {
          "type": "string",
          "description": "The content of the notification message."
        },
        "read": {
          "type": "boolean",
          "description": "Whether the notification has been read."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the notification was created."
        },
        "adminId": {
          "type": "string",
          "description": "The UID of the admin who performed the action."
        }
      },
      "required": [
        "id",
        "message",
        "read",
        "createdAt",
        "adminId"
      ]
    },
    "RedeemCode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RedeemCode",
      "type": "object",
      "description": "Represents a redeemable code for users to add virtual currency.",
      "properties": {
        "code": {
          "type": "string",
          "description": "The unique redeem code string."
        },
        "amount": {
          "type": "number",
          "description": "The virtual currency amount this code provides."
        },
        "used": {
          "type": "boolean",
          "description": "Indicates whether the code has already been redeemed."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the code was generated."
        },
        "usedBy": {
          "type": "string",
          "description": "The UID of the user who redeemed the code."
        },
        "usedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the code was redeemed."
        }
      },
      "required": [
        "code",
        "amount",
        "used",
        "createdAt"
      ]
    },
    "DailyLimit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DailyLimit",
      "type": "object",
      "description": "Tracks the total daily transaction amount for a given payment account.",
      "properties": {
        "totalAmount": {
          "type": "number",
          "description": "The accumulated amount for the day."
        },
        "date": {
          "type": "string",
          "format": "date",
          "description": "The date for which the limit is tracked (YYYY-MM-DD)."
        }
      },
      "required": [
        "totalAmount",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information. Uses path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user account, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/messages/{messageId}",
        "definition": {
          "entityName": "UserMessage",
          "schema": {
            "$ref": "#/backend/entities/UserMessage"
          },
          "description": "Stores inbox messages sent by an admin to a specific user. Only the user can read, only admin can write.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user account."
            },
            {
              "name": "messageId",
              "description": "The unique identifier for the message."
            }
          ]
        }
      },
      {
        "path": "/mining_machines/{miningMachineId}",
        "definition": {
          "entityName": "MiningMachine",
          "schema": {
            "$ref": "#/backend/entities/MiningMachine"
          },
          "description": "Stores information about available mining machines.",
          "params": [
            {
              "name": "miningMachineId",
              "description": "The unique identifier for the mining machine."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/rentals/{rentalId}",
        "definition": {
          "entityName": "RentalTransaction",
          "schema": {
            "$ref": "#/backend/entities/RentalTransaction"
          },
          "description": "Stores rental transaction data for a user. Includes denormalized 'userAccountId' to guarantee authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user account that created this rental transaction. (Relationship: UserAccount 1:N RentalTransaction)"
            },
            {
              "name": "rentalId",
              "description": "The unique identifier for the rental transaction."
            }
          ]
        }
      },
      {
        "path": "/deposit_transactions/{depositTransactionId}",
        "definition": {
          "entityName": "DepositTransaction",
          "schema": {
            "$ref": "#/backend/entities/DepositTransaction"
          },
          "description": "Stores all deposit transactions. Admin needs to read all of them to confirm. User can read their own.",
          "params": [
            {
              "name": "depositTransactionId",
              "description": "The unique identifier for the deposit transaction."
            }
          ]
        }
      },
      {
        "path": "/withdrawal_transactions/{withdrawalTransactionId}",
        "definition": {
          "entityName": "WithdrawalTransaction",
          "schema": {
            "$ref": "#/backend/entities/WithdrawalTransaction"
          },
          "description": "Stores all withdrawal transactions. Admin needs to read all to confirm. User can read their own.",
          "params": [
            {
              "name": "withdrawalTransactionId",
              "description": "The unique identifier for the withdrawal transaction."
            }
          ]
        }
      },
      {
        "path": "/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores notifications for admin actions, like approving or declining deposits.",
          "params": [
            {
              "name": "notificationId",
              "description": "The unique identifier for the notification."
            }
          ]
        }
      },
      {
        "path": "/redeem_codes/{code}",
        "definition": {
          "entityName": "RedeemCode",
          "schema": {
            "$ref": "#/backend/entities/RedeemCode"
          },
          "description": "Stores redeemable codes for users to add virtual currency.",
          "params": [
            {
              "name": "code",
              "description": "The unique redeem code string, used as the document ID."
            }
          ]
        }
      },
      {
        "path": "/daily_limits/{date}_{accountNumber}",
        "definition": {
          "entityName": "DailyLimit",
          "schema": {
            "$ref": "#/backend/entities/DailyLimit"
          },
          "description": "Tracks daily transaction totals for each payment account to enforce limits.",
          "params": [
            {
              "name": "date",
              "description": "The date in YYYY-MM-DD format."
            },
            {
              "name": "accountNumber",
              "description": "The payment account number being tracked."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging. User-specific data like rentals and inbox messages are nested under the user's document for clear ownership and security. Global data like mining machines are in a root collection. Deposit transactions and notifications are in root collections so that admins can query all of them, with security rules ensuring users can only read their own deposits, while admins can read all and update status. Redeem codes are in a root collection for admin management and user redemption. Daily limits are stored in a root collection to be globally accessible for checking transaction thresholds."
  }
}
